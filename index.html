<!DOCTYPE html>
<html>
<head>
    <title>Interactive Drawing with Sensors</title>
    <style>
        #canvas {
            border: 1px solid black;
            width: 100%;
            height: 400px;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <p>Rotate your device to draw. The magnetic direction and ambient light will affect the drawing color.</p>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;

        let hue = 0;
        let lightLevel = 100; // Default light level

        // Handle device orientation
        window.addEventListener('deviceorientation', event => {
            const { alpha, beta, gamma } = event;

            // Use gamma for horizontal movement, beta for vertical
            const x = mapRange(gamma, -90, 90, 0, canvas.width);
            const y = mapRange(beta, -90, 90, 0, canvas.height);

            draw(x, y, `hsl(${hue}, 100%, ${lightLevel}%)`);
        });

        // Map range function
        function mapRange(value, a, b, c, d) {
            value = (value - a) / (b - a);
            return c + value * (d - c);
        }

        // Draw function
        function draw(x, y, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, 10, 0, 2 * Math.PI);
            ctx.fill();
        }

        // Update color based on magnetic orientation
        window.addEventListener('compassneedscalibration', event => {
            event.preventDefault();
            hue = (hue + 5) % 360;
        });

        // Attempt to access ambient light sensor (works only in some browsers)
        if ('AmbientLightSensor' in window) {
            try {
                const sensor = new AmbientLightSensor();
                sensor.addEventListener('reading', () => {
                    lightLevel = sensor.illuminance;
                });
                sensor.start();
            } catch (e) {
                console.log('AmbientLightSensor not supported');
            }
        }
    </script>
</body>
</html>
