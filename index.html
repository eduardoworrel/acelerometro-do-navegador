<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Velocidade por Eixo com Acelerômetro</title>
</head>
<body>
    <br>
    <h1 id="velocityX">Velocidade X: 0 m/s</h1>
    <h1 id="velocityY">Velocidade Y: 0 m/s</h1>
    <h1 id="velocityZ">Velocidade Z: 0 m/s</h1>
    <br>
    <button id="startButton">Iniciar Captura de Movimento</button>

    <script>
        let velocity = { x: 0, y: 0, z: 0 };
        let lastTime = Date.now();
        const stationaryThreshold = 0.05; // Limite para considerar o dispositivo como parado

        function updateVelocity(ax, ay, az) {
            let currentTime = Date.now();
            let deltaTime = (currentTime - lastTime) / 1000; // Tempo em segundos
            lastTime = currentTime;

            // Atualizando a velocidade para cada eixo
            velocity.x += ax * deltaTime;
            velocity.y += ay * deltaTime;
            velocity.z += az * deltaTime;

            // Se o dispositivo estiver praticamente parado, zere a velocidade
            if (Math.abs(ax) < stationaryThreshold && Math.abs(ay) < stationaryThreshold && Math.abs(az) < stationaryThreshold) {
                velocity.x = 0;
                velocity.y = 0;
                velocity.z = 0;
            }

            // Exibindo as velocidades de cada eixo
            document.getElementById('velocityX').textContent = `Velocidade X: ${velocity.x.toFixed(2)} m/s`;
            document.getElementById('velocityY').textContent = `Velocidade Y: ${velocity.y.toFixed(2)} m/s`;
            document.getElementById('velocityZ').textContent = `Velocidade Z: ${velocity.z.toFixed(2)} m/s`;
        }

        function handleMotionEvent(event) {
            let ax = event.acceleration.x;
            let ay = event.acceleration.y;
            let az = event.acceleration.z;
            updateVelocity(ax, ay, az);
        }

        function initSensor() {
            if ('LinearAccelerationSensor' in window) {
                const sensor = new LinearAccelerationSensor();
                sensor.addEventListener('reading', () => updateVelocity(sensor.x, sensor.y, sensor.z));
                sensor.start();
            } else if ('DeviceMotionEvent' in window) {
                window.addEventListener('devicemotion', handleMotionEvent);
            } else {
                alert('Sensores de movimento não são suportados neste dispositivo.');
            }
        }

        document.getElementById('startButton').addEventListener('click', function() {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                // Para iOS 13+
                DeviceMotionEvent.requestPermission().then(permissionState => {
                    if (permissionState === 'granted') {
                        initSensor();
                    } else {
                        alert('Permissão para acessar os sensores negada.');
                    }
                }).catch(console.error);
            } else {
                // Para outros navegadores
                initSensor();
            }
        });
    </script>
</body>
</html>
